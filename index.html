<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Ghost Market - Ultra Security</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #0b0c0f; --panel: #16171d; --accent: #bb86fc; --text: #e1e1e1; --gold: #ffd700; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
        
        /* –ï–∫—Ä–∞–Ω–∏ */
        #reg-screen { position: fixed; inset: 0; background: var(--bg); z-index: 30000; display: flex; align-items: center; justify-content: center; }
        #errScr { display: none; position: fixed; inset: 0; background: #000; z-index: 40000; text-align: center; justify-content: center; flex-direction: column; color: white; }
        
        .header { height: 60px; background: var(--panel); display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid #333; justify-content: space-between; position: relative; z-index: 10001; }
        .wrapper { display: grid; grid-template-columns: 220px 1fr 300px; height: calc(100vh - 60px); }
        
        .coin-balance { color: var(--gold); font-weight: bold; background: #25262b; padding: 5px 15px; border-radius: 20px; border: 1px solid #444; }
        .btn-logout { background: #ff4d4d !important; color: white !important; margin-left: 10px; padding: 5px 10px !important; font-size: 11px !important; cursor: pointer; border: none; border-radius: 5px; }

        .feed { padding: 20px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 20px; align-content: flex-start; }
        .item-card { background: var(--panel); width: 230px; border-radius: 12px; border: 1px solid #333; overflow: hidden; position: relative; display: flex; flex-direction: column; min-height: 250px; }
        .locked-blur { filter: blur(5px); opacity: 0.5; pointer-events: none; }
        
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; background: #25262b; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; }
        button { padding: 10px; background: var(--accent); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .ghost-img { width: 150px; animation: float 3s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>
</head>
<body>

    <div id="errScr">
        <img src="image_7cdb7b.png" class="ghost-img">
        <h1>ACCESS DENIED</h1>
        <p>–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –∑–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª.</p>
        <button onclick="logout()" style="background: white; color: black; margin-top: 20px;">–í–ò–ô–¢–ò</button>
    </div>

    <div id="reg-screen">
        <div style="background:var(--panel); padding:30px; border-radius:15px; text-align:center; width:300px; border: 1px solid #444;">
            <h2 style="color:var(--accent);">Ghost Market</h2>
            <input type="text" id="user-login" placeholder="–ù—ñ–∫–Ω–µ–π–º">
            <button onclick="startSession()" style="width:100%; margin-top:10px;">–£–í–Ü–ô–¢–ò</button>
        </div>
    </div>

    <div class="header">
        <div style="display:flex; gap:15px; align-items:center;">
            <b>GHOST SYSTEM</b>
            <div class="coin-balance">üí∞ <span id="balance-val">0</span></div>
            <button onclick="usePromo()" style="background:#333; color:white; padding:5px 10px; font-size:11px;">–ü–†–û–ú–û</button>
            <button onclick="logout()" class="btn-logout">–í–ò–•–Ü–î</button>
        </div>
        <div style="width:30px; height:30px; background:#444; border-radius:50%; cursor:pointer;" onclick="openAdmin()"></div>
    </div>

    <div class="wrapper" id="main-wrapper">
        <div style="padding:15px; border-right:1px solid #333;">
            <h4>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h4>
            <div id="my-items" style="font-size:12px; color:#888;"></div>
        </div>
        <div class="feed" id="main-feed"></div>
        <div style="background:var(--panel); display:flex; flex-direction:column; border-left:1px solid #333;">
            <div id="chat-box" style="flex:1; padding:15px; overflow-y:auto;"></div>
            <input type="text" id="chat-input" placeholder="–ß–∞—Ç (+10üí∞)..." onkeypress="sendChat(event)" style="padding:15px; border:none; border-top:1px solid #333; background:#1a1b21; color:white;">
        </div>
    </div>

    <button style="position:fixed; bottom:20px; right:320px; width:60px; height:60px; border-radius:50%; background:var(--accent); border:none; font-size:30px; cursor:pointer;" onclick="document.getElementById('addModal').style.display='flex'">+</button>

    <div id="addModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:15000; align-items:center; justify-content:center;">
        <div style="background:var(--panel); padding:25px; border-radius:15px; width:350px;">
            <h3>–ù–æ–≤–∏–π –ø–æ—Å—Ç</h3>
            <input type="text" id="f-title" placeholder="–ù–∞–∑–≤–∞">
            <input type="text" id="f-img" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏">
            <input type="number" id="f-price" placeholder="–¶—ñ–Ω–∞">
            <textarea id="f-desc" placeholder="–°–µ–∫—Ä–µ—Ç–Ω–∏–π –æ–ø–∏—Å"></textarea>
            <button onclick="publish()" style="width:100%;">–û–ü–£–ë–õ–Ü–ö–£–í–ê–¢–ò</button>
            <button onclick="document.getElementById('addModal').style.display='none'" style="background:none; color:grey; width:100%;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <div id="admin-panel" style="display:none; position:fixed; top:70px; left:5%; width:90%; height:80%; background:#111; z-index:20000; border:2px solid var(--accent); padding:20px; overflow-y:auto; border-radius:15px;">
        <div style="display:flex; justify-content:space-between;"><h2>–ê–¥–º—ñ–Ω–∫–∞</h2><button onclick="this.parentElement.parentElement.style.display='none'">X</button></div>
        <div id="admin-list"></div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://book-main-1fc44-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let myNick = localStorage.getItem('ghost_user') || "";
        let myCoins = 0;

        // 1. –ì–û–õ–û–í–ù–ê –ü–ï–†–ï–í–Ü–†–ö–ê (–ë–ê–ù)
        function checkBan(nick) {
            db.ref('banned').child(nick).on('value', s => {
                if (s.exists() && s.val() === true) {
                    document.getElementById('errScr').style.display = 'flex';
                    document.getElementById('main-wrapper').style.visibility = 'hidden';
                } else {
                    document.getElementById('errScr').style.display = 'none';
                    document.getElementById('main-wrapper').style.visibility = 'visible';
                }
            });
        }

        function syncUser(nick) {
            checkBan(nick); // –ó–∞–ø—É—Å–∫–∞—î–º–æ –±–∞–Ω-–∫–æ–Ω—Ç—Ä–æ–ª—å
            db.ref('users').child(nick).on('value', s => {
                const data = s.val() || { coins: 0 };
                myCoins = data.coins || 0;
                document.getElementById('balance-val').innerText = myCoins;
                const itemsDiv = document.getElementById('my-items');
                itemsDiv.innerHTML = data.inventory ? "‚Ä¢ " + Object.values(data.inventory).join("<br>‚Ä¢ ") : "–ü–æ—Ä–æ–∂–Ω—å–æ";
            });
        }

        function startSession() {
            const n = document.getElementById('user-login').value.trim();
            if(n.length < 2) return;
            myNick = n;
            localStorage.setItem('ghost_user', n);
            document.getElementById('reg-screen').style.display = 'none';
            syncUser(n);
        }

        function logout() {
            localStorage.removeItem('ghost_user');
            location.reload();
        }

        if(myNick) {
            document.getElementById('reg-screen').style.display = 'none';
            syncUser(myNick);
        }

        // 2. –†–ò–ù–û–ö –¢–ê –ê–î–ú–Ü–ù–ö–ê
        db.ref('posts').on('value', snapshot => {
            const feed = document.getElementById('main-feed');
            const alist = document.getElementById('admin-list');
            feed.innerHTML = ""; alist.innerHTML = "<h4>–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏:</h4>";

            snapshot.forEach(child => {
                const d = child.val();
                const id = child.key;
                const price = parseInt(d.price) || 0;

                db.ref('users').child(myNick).child('inventory').child(id).once('value', bought => {
                    const isBought = bought.exists() || d.nick === myNick;
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    card.innerHTML = `
                        <div style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.8); padding:4px 8px; border-radius:6px; color:var(--gold); font-size:12px; border:1px solid var(--gold); z-index:5;">üí∞ ${price}</div>
                        <img src="${d.img}" style="width:100%; height:130px; object-fit:cover;">
                        <div style="padding:12px;" class="${!isBought ? 'locked-blur' : ''}">
                            <b>${d.title}</b><br>
                            <p style="font-size:11px; color:#888;">${isBought ? d.desc : 'üîí –ö—É–ø—ñ—Ç—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É'}</p>
                            <span style="color:var(--accent); font-size:10px;">@${d.nick}</span>
                        </div>
                        ${!isBought ? `<button onclick="buyItem('${id}', ${price}, '${d.title}', '${d.nick}')" style="margin:10px; background:var(--gold); color:black; border:none; padding:8px; border-radius:5px; font-weight:bold;">–ö–£–ü–ò–¢–ò</button>` : `<div style="text-align:center; padding:10px; color:var(--gold); font-size:12px;">–û–¢–†–ò–ú–ê–ù–û</div>`}
                    `;
                    feed.appendChild(card);
                });

                alist.innerHTML += `<div style="background:#222; padding:10px; margin-bottom:5px; display:flex; justify-content:space-between;">
                    <span>${d.nick} (${d.title})</span>
                    <button onclick="db.ref('banned').child('${d.nick}').set(true)" style="background:orange;">BAN</button>
                    <button onclick="db.ref('banned').child('${d.nick}').remove()" style="background:green;">UNBAN</button>
                    <button onclick="db.ref('posts').child('${id}').remove()" style="background:red;">DEL</button>
                </div>`;
            });
        });

        function buyItem(id, price, title, owner) {
            if(myCoins < price) return alert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!");
            if(confirm(`–ö—É–ø–∏—Ç–∏ ${title}?`)) {
                db.ref('users').child(myNick).child('coins').set(myCoins - price);
                db.ref('users').child(myNick).child('inventory').child(id).set(title);
                db.ref('users').child(owner).child('coins').once('value', s => {
                    db.ref('users').child(owner).child('coins').set((s.val() || 0) + price);
                });
            }
        }

        function publish() {
            db.ref('posts').push({
                nick: myNick, title: document.getElementById('f-title').value,
                img: document.getElementById('f-img').value, price: document.getElementById('f-price').value,
                desc: document.getElementById('f-desc').value
            });
            document.getElementById('addModal').style.display = 'none';
        }

        function sendChat(e) {
            if(e.key === 'Enter' && e.target.value.trim() !== "") {
                db.ref('chat').push({ user: myNick, text: e.target.value });
                db.ref('users').child(myNick).child('coins').set(myCoins + 10);
                e.target.value = "";
            }
        }

        db.ref('chat').limitToLast(15).on('child_added', s => {
            const cb = document.getElementById('chat-box');
            cb.innerHTML += `<div><b>${s.val().user}:</b> ${s.val().text}</div>`;
            cb.scrollTop = cb.scrollHeight;
        });

        function openAdmin() { if(prompt("Pass:") === "loldemid509") document.getElementById('admin-panel').style.display = 'block'; }
        function usePromo() {
            const c = prompt("–ö–æ–¥:").toUpperCase();
            db.ref('promos').child(c).once('value', s => {
                if(s.exists()) {
                    db.ref('users').child(myNick).child('coins').set(myCoins + s.val());
                    db.ref('promos').child(c).remove();
                    alert("–ë–æ–Ω—É—Å –æ—Ç—Ä–∏–º–∞–Ω–æ!");
                }
            });
        }
    </script>
</body>
</html>
