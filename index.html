<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Ghost Market - Shop System</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #0b0c0f; --panel: #16171d; --accent: #bb86fc; --text: #e1e1e1; --gold: #ffd700; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
        
        .header { height: 60px; background: var(--panel); display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid #333; justify-content: space-between; position: relative; z-index: 10001; }
        .coin-balance { color: var(--gold); font-weight: bold; background: #25262b; padding: 5px 15px; border-radius: 20px; border: 1px solid #444; }

        .wrapper { display: grid; grid-template-columns: 220px 1fr 300px; height: calc(100vh - 60px); }
        .feed { padding: 20px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 20px; align-content: flex-start; }
        
        /* –ö–∞—Ä—Ç–∫–∏ —Ç–æ–≤–∞—Ä—ñ–≤ */
        .item-card { background: var(--panel); width: 230px; border-radius: 12px; border: 1px solid #333; overflow: hidden; position: relative; transition: 0.3s; height: fit-content; }
        .item-card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .price-tag { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 6px; color: var(--gold); font-size: 12px; font-weight: bold; z-index: 10; }
        .item-img { width: 100%; height: 130px; object-fit: cover; background: #222; }
        .item-info { padding: 12px; }

        /* –õ–æ–≥—ñ–∫–∞ –∑–∞–º–æ—á–∫–∞ */
        .locked-content { filter: blur(4px); pointer-events: none; user-select: none; opacity: 0.5; }
        .buy-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 60px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); display: flex; align-items: center; justify-content: center; z-index: 5; }
        .btn-buy { background: var(--gold); color: black; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; }

        #admin-panel { display: none; position: fixed; top: 70px; left: 5%; width: 90%; height: 80%; background: #111; z-index: 20000; border: 2px solid var(--accent); padding: 20px; overflow-y: auto; border-radius: 15px; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; background: #25262b; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; }
        button { padding: 10px; background: var(--accent); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .error-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; text-align: center; justify-content: center; flex-direction: column; }
    </style>
</head>
<body>

    <div id="reg-screen" style="position:fixed; width:100%; height:100%; background:var(--bg); z-index:30000; display:flex; align-items:center; justify-content:center;">
        <div style="background:var(--panel); padding:30px; border-radius:15px; text-align:center; width:300px;">
            <h2>Ghost Market</h2>
            <input type="text" id="user-login" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º">
            <button onclick="startSession()" style="width:100%; margin-top:10px;">–ü–û–ß–ê–¢–ò</button>
        </div>
    </div>

    <div class="header">
        <div style="display:flex; gap:15px; align-items:center;">
            <b style="color:var(--accent);">GHOST SYSTEM</b>
            <div class="coin-balance">üí∞ <span id="balance-val">0</span></div>
            <button onclick="usePromo()" style="background:#333; color:white; font-size:11px;">–ü–†–û–ú–û–ö–û–î</button>
        </div>
        <div style="width:30px; height:30px; background:#444; border-radius:50%; cursor:pointer;" onclick="openAdmin()"></div>
    </div>

    <div class="wrapper">
        <div class="side" style="padding:15px; border-right:1px solid #333;">
            <h4>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h4>
            <div id="my-items" style="font-size:12px; color:#888;">–ü–æ–∫–∏ –ø–æ—Ä–æ–∂–Ω—å–æ...</div>
        </div>
        <div class="feed" id="main-feed"></div>
        <div class="chat" style="background:var(--panel); display:flex; flex-direction:column; border-left:1px solid #333;">
            <div id="chat-box" style="flex:1; padding:15px; overflow-y:auto;"></div>
            <input type="text" id="chat-input" placeholder="–ü–∏—à–∏ —Å—é–¥–∏ (+10üí∞)..." onkeypress="sendChat(event)" style="border-radius:0; border:none; border-top:1px solid #333;">
        </div>
    </div>

    <div id="addModal" class="error-overlay" style="background:rgba(0,0,0,0.8); z-index:15000;">
        <div style="background:var(--panel); padding:25px; border-radius:15px; width:350px;">
            <h3>–í–∏—Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∂</h3>
            <input type="text" id="f-title" placeholder="–ù–∞–∑–≤–∞">
            <input type="text" id="f-img" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ñ–æ—Ç–æ">
            <input type="number" id="f-price" placeholder="–¶—ñ–Ω–∞ (—Ç—ñ–ª—å–∫–∏ —Ü–∏—Ñ—Ä–∏)">
            <textarea id="f-desc" placeholder="–°–µ–∫—Ä–µ—Ç–Ω–∏–π –æ–ø–∏—Å (–≤–∏–¥–Ω–æ –ø—ñ—Å–ª—è –ø–æ–∫—É–ø–∫–∏)"></textarea>
            <button onclick="publish()" style="width:100%;">–í–ò–°–¢–ê–í–ò–¢–ò</button>
            <button onclick="document.getElementById('addModal').style.display='none'" style="background:none; color:grey;">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <div id="admin-panel">
        <div style="display:flex; justify-content:space-between;"><h2>–ê–¥–º—ñ–Ω-—Ü–µ–Ω—Ç—Ä</h2><button onclick="this.parentElement.parentElement.style.display='none'">–ó–∞–∫—Ä–∏—Ç–∏</button></div>
        <div style="background:#222; padding:15px; border-radius:10px; margin-bottom:20px;">
            <h4>–°—Ç–≤–æ—Ä–∏—Ç–∏ –ü—Ä–æ–º–æ</h4>
            <input type="text" id="p-code" placeholder="–ö–æ–¥">
            <input type="number" id="p-amount" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º–æ–Ω–µ—Ç">
            <button onclick="createPromo()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
        </div>
        <div id="admin-list"></div>
    </div>

    <div id="errScr" class="error-overlay"><h1>üîí BAN</h1><p>–î–æ—Å—Ç—É–ø –æ–±–º–µ–∂–µ–Ω–æ.</p></div>
    <button style="position:fixed; bottom:20px; right:320px; width:60px; height:60px; border-radius:50%; background:var(--accent); border:none; font-size:30px; cursor:pointer;" onclick="document.getElementById('addModal').style.display='flex'">+</button>

    <script>
        const firebaseConfig = { databaseURL: "https://book-main-1fc44-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let myNick = localStorage.getItem('ghost_user') || "";
        let myCoins = 0;

        function syncUser(nick) {
            db.ref('users').child(nick).on('value', s => {
                myCoins = (s.val() && s.val().coins) || 0;
                document.getElementById('balance-val').innerText = myCoins;
                // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–∏—Ö —Ä–µ—á–µ–π
                const itemsDiv = document.getElementById('my-items');
                if(s.val() && s.val().inventory) {
                    itemsDiv.innerHTML = "<b>–ö—É–ø–ª–µ–Ω–æ:</b><br>" + Object.values(s.val().inventory).join(", ");
                }
            });
            db.ref('banned').child(nick).on('value', s => {
                document.getElementById('errScr').style.display = s.exists() ? 'flex' : 'none';
            });
        }

        function startSession() {
            const n = document.getElementById('user-login').value.trim();
            if(n.length < 2) return;
            myNick = n; localStorage.setItem('ghost_user', n);
            document.getElementById('reg-screen').style.display = 'none';
            syncUser(n);
        }
        if(myNick) { syncUser(myNick); document.getElementById('reg-screen').style.display = 'none'; }

        // –ü–£–ë–õ–Ü–ö–ê–¶–Ü–Ø –¢–ê –ü–û–ö–£–ü–ö–ê
        db.ref('posts').on('value', snapshot => {
            const feed = document.getElementById('main-feed');
            feed.innerHTML = "";
            snapshot.forEach(child => {
                const d = child.val();
                const id = child.key;
                const price = parseInt(d.price) || 0;

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —é–∑–µ—Ä –≤–∂–µ –∫—É–ø–∏–≤ —Ü–µ–π —Ç–æ–≤–∞—Ä
                db.ref('users').child(myNick).child('inventory').child(id).once('value', bought => {
                    const isBought = bought.exists() || d.nick === myNick;
                    
                    const card = document.createElement('div');
                    card.className = 'item-card';
                    card.innerHTML = `
                        <div class="price-tag">üí∞ ${price}</div>
                        <img src="${d.img}" class="item-img" onerror="this.src='https://via.placeholder.com/230x130?text=Ghost+Item'">
                        <div class="item-info ${!isBought ? 'locked-content' : ''}">
                            <b>${d.title}</b><br>
                            <small>${isBought ? d.desc : 'üîí –í–º—ñ—Å—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ'}</small><br>
                            <span style="color:var(--accent); font-size:11px;">@${d.nick}</span>
                        </div>
                        ${!isBought ? `<div class="buy-overlay"><button class="btn-buy" onclick="buyItem('${id}', ${price}, '${d.title}')">üõí –ö–£–ü–ò–¢–ò</button></div>` : ''}
                    `;
                    feed.appendChild(card);
                });
            });
        });

        function buyItem(id, price, title) {
            if(myCoins < price) {
                alert("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç! –ü–∏—à–∏ –≤ —á–∞—Ç, —â–æ–± –∑–∞—Ä–æ–±–∏—Ç–∏.");
                return;
            }
            if(confirm(`–ö—É–ø–∏—Ç–∏ "${title}" –∑–∞ ${price}üí∞?`)) {
                db.ref('users').child(myNick).child('coins').set(myCoins - price);
                db.ref('users').child(myNick).child('inventory').child(id).set(title);
                alert("‚úÖ –£—Å–ø—ñ—à–Ω–æ –∫—É–ø–ª–µ–Ω–æ! –û–ø–∏—Å —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–æ.");
            }
        }

        function publish() {
            const title = document.getElementById('f-title').value;
            const price = document.getElementById('f-price').value;
            if(!title || !price) return alert("–ó–∞–ø–æ–≤–Ω–∏ –Ω–∞–∑–≤—É —Ç–∞ —Ü—ñ–Ω—É!");
            db.ref('posts').push({
                nick: myNick,
                title: title,
                img: document.getElementById('f-img').value,
                price: price,
                desc: document.getElementById('f-desc').value
            });
            document.getElementById('addModal').style.display = 'none';
        }

        // –Ü–ù–®–ï (–ß–∞—Ç, –ü—Ä–æ–º–æ, –ê–¥–º—ñ–Ω–∫–∞)
        function sendChat(e) {
            if(e.key === 'Enter' && e.target.value.trim() !== "") {
                db.ref('chat').push({ user: myNick, text: e.target.value });
                db.ref('users').child(myNick).child('coins').set(myCoins + 10);
                e.target.value = "";
            }
        }

        function createPromo() {
            const c = document.getElementById('p-code').value.toUpperCase();
            const a = parseInt(document.getElementById('p-amount').value);
            if(c && a) db.ref('promos').child(c).set(a);
        }

        function usePromo() {
            const c = prompt("–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥:").toUpperCase();
            db.ref('promos').child(c).once('value', s => {
                if(s.exists()) {
                    db.ref('users').child(myNick).child('coins').set(myCoins + s.val());
                    db.ref('promos').child(c).remove();
                    alert(`+${s.val()} –º–æ–Ω–µ—Ç!`);
                } else alert("–ö–æ–¥ –Ω–µ–¥—ñ–π—Å–Ω–∏–π.");
            });
        }

        function openAdmin() { if(prompt("Pass:") === "loldemid509") document.getElementById('admin-panel').style.display = 'block'; }
        db.ref('chat').limitToLast(15).on('child_added', s => {
            const cb = document.getElementById('chat-box');
            cb.innerHTML += `<div><b>${s.val().user}:</b> ${s.val().text}</div>`;
            cb.scrollTop = cb.scrollHeight;
        });
    </script>
</body>
</html>
